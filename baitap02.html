<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i t·∫≠p 2: Form ƒëƒÉng k√Ω</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .register-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .form-group input.error {
            border-color: #e74c3c;
            background-color: #fff5f5;
        }
        
        .form-group input.success {
            border-color: #2ecc71;
            background-color: #f0fff4;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        .password-rules {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .password-rules ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        
        .password-strength {
            height: 5px;
            background: #ddd;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .password-strength-fill {
            height: 100%;
            width: 0%;
            transition: width 0.3s, background 0.3s;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .submit-btn:hover {
            background: #2980b9;
        }
        
        .submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #2ecc71;
            display: none;
        }
        
        .users-list {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .users-list h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .user-item {
            background: white;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-email {
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .form-container {
                padding: 10px;
            }
            
            .register-form {
                padding: 20px;
            }
            
            .checkbox-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="main-menu">
            <a href="baitap01.html" class="menu-link">‚Üê B√†i t·∫≠p 1</a>
            <a href="index.html" class="menu-link">Trang ch·ªß</a>
            <a href="baitap03.html" class="menu-link">B√†i t·∫≠p 3 ‚Üí</a>
	    <a href="https://toantfx.github.io/baitap14.html-" class="menu-link" target="_blank">B√†i 14: Memory Game</a>
        </nav>

        <header class="exercise-header">
            <h1>üìù B√†i t·∫≠p 2: Form ƒëƒÉng k√Ω ng∆∞·ªùi d√πng</h1>
            <p class="subtitle">(20 ƒëi·ªÉm) Validate v√† l∆∞u d·ªØ li·ªáu v√†o LocalStorage</p>
        </header>

        <main>
            <div class="form-container">
                <form id="registerForm" class="register-form">
                    <div class="form-group">
                        <label for="name">H·ªç v√† t√™n:</label>
                        <input type="text" id="name" name="name" placeholder="Nguy·ªÖn VƒÉn A" required>
                        <div class="error-message" id="name-error">Vui l√≤ng nh·∫≠p h·ªç t√™n h·ª£p l·ªá (√≠t nh·∫•t 2 k√Ω t·ª±)</div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" placeholder="example@email.com" required>
                        <div class="error-message" id="email-error">Vui l√≤ng nh·∫≠p email h·ª£p l·ªá</div>
                    </div>

                    <div class="form-group">
                        <label for="password">M·∫≠t kh·∫©u:</label>
                        <input type="password" id="password" name="password" placeholder="********" required>
                        <div class="password-strength">
                            <div class="password-strength-fill" id="password-strength"></div>
                        </div>
                        <div class="password-rules">
                            <p>M·∫≠t kh·∫©u ph·∫£i c√≥:</p>
                            <ul>
                                <li id="rule-length">√çt nh·∫•t 8 k√Ω t·ª±</li>
                                <li id="rule-uppercase">Ch·ª©a ch·ªØ hoa</li>
                                <li id="rule-lowercase">Ch·ª©a ch·ªØ th∆∞·ªùng</li>
                                <li id="rule-number">Ch·ª©a s·ªë</li>
                            </ul>
                        </div>
                        <div class="error-message" id="password-error">M·∫≠t kh·∫©u kh√¥ng ƒë·ªß m·∫°nh</div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" name="terms" required>
                        <label for="terms">T√¥i ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng</label>
                    </div>
                    <div class="error-message" id="terms-error">Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n</div>

                    <button type="submit" class="submit-btn" id="submit-btn">ƒêƒÉng k√Ω</button>
                </form>

                <!-- Th√¥ng b√°o th√†nh c√¥ng -->
                <div class="success-message" id="success-message">
                    <h3>üéâ ƒêƒÉng k√Ω th√†nh c√¥ng!</h3>
                    <p>D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o LocalStorage.</p>
                    <p>Xem danh s√°ch ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω b√™n d∆∞·ªõi:</p>
                </div>

                <!-- Danh s√°ch ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω -->
                <div class="users-list">
                    <h3>üë• Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω:</h3>
                    <div id="users-container">
                        <!-- Danh s√°ch s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                    </div>
                </div>

                <!-- Gi·∫£i th√≠ch logic -->
                <div class="logic-explanation" style="margin-top: 30px;">
                    <h3>üîê Logic t∆∞ duy v√† gi·∫£i th√≠ch:</h3>
                    
                    <h4>1. X·ª≠ l√Ω s·ª± ki·ªán submit:</h4>
                    <ul>
                        <li><strong>Prevent default</strong>: NgƒÉn form submit theo c√°ch truy·ªÅn th·ªëng</li>
                        <li><strong>Real-time validation</strong>: Ki·ªÉm tra t·ª´ng field khi ng∆∞·ªùi d√πng nh·∫≠p</li>
                        <li><strong>Debounced validation</strong>: Ch·ªù 300ms sau khi ng·ª´ng g√µ m·ªõi validate</li>
                        <li><strong>Custom validation messages</strong>: Hi·ªÉn th·ªã l·ªói c·ª• th·ªÉ cho t·ª´ng tr∆∞·ªùng</li>
                    </ul>

                    <h4>2. B·∫£o m·∫≠t d·ªØ li·ªáu c·ª•c b·ªô (LocalStorage):</h4>
                    <ul>
                        <li><strong>Hash password</strong>: Kh√¥ng l∆∞u m·∫≠t kh·∫©u d·∫°ng plain text (demo: base64)</li>
                        <li><strong>Data sanitization</strong>: Lo·∫°i b·ªè script tags v√† k√Ω t·ª± nguy hi·ªÉm</li>
                        <li><strong>Maximum storage check</strong>: Ki·ªÉm tra kh√¥ng v∆∞·ª£t qu√° 5MB</li>
                        <li><strong>Session timeout</strong>: Auto-clear sau 30 ph√∫t (demo)</li>
                        <li><strong>No sensitive data</strong>: Kh√¥ng l∆∞u th√¥ng tin nh·∫°y c·∫£m</li>
                    </ul>

                    <h4>3. Performance & UX:</h4>
                    <ul>
                        <li>Progress indicators cho password strength</li>
                        <li>Disable submit button trong khi x·ª≠ l√Ω</li>
                        <li>Form state persistence (n·∫øu page refresh)</li>
                        <li>Responsive design cho mobile</li>
                    </ul>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>¬© 2024 B√†i ki·ªÉm tra LTW - B√†i t·∫≠p 2</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            const submitBtn = document.getElementById('submit-btn');
            const successMessage = document.getElementById('success-message');
            const usersContainer = document.getElementById('users-container');
            
            // Elements
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const termsCheckbox = document.getElementById('terms');
            
            // Error elements
            const nameError = document.getElementById('name-error');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            const termsError = document.getElementById('terms-error');
            
            // Password strength indicator
            const passwordStrength = document.getElementById('password-strength');
            
            // Password rules elements
            const ruleLength = document.getElementById('rule-length');
            const ruleUppercase = document.getElementById('rule-uppercase');
            const ruleLowercase = document.getElementById('rule-lowercase');
            const ruleNumber = document.getElementById('rule-number');
            
            // Validate name
            function validateName(name) {
                return name.trim().length >= 2;
            }
            
            // Validate email
            function validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }
            
            // Validate password
            function validatePassword(password) {
                const hasLength = password.length >= 8;
                const hasUppercase = /[A-Z]/.test(password);
                const hasLowercase = /[a-z]/.test(password);
                const hasNumber = /\d/.test(password);
                
                // Update rule indicators
                ruleLength.style.color = hasLength ? '#2ecc71' : '#e74c3c';
                ruleUppercase.style.color = hasUppercase ? '#2ecc71' : '#e74c3c';
                ruleLowercase.style.color = hasLowercase ? '#2ecc71' : '#e74c3c';
                ruleNumber.style.color = hasNumber ? '#2ecc71' : '#e74c3c';
                
                // Calculate strength
                let strength = 0;
                if (hasLength) strength += 25;
                if (hasUppercase) strength += 25;
                if (hasLowercase) strength += 25;
                if (hasNumber) strength += 25;
                
                // Update strength indicator
                passwordStrength.style.width = strength + '%';
                passwordStrength.style.backgroundColor = 
                    strength >= 75 ? '#2ecc71' : 
                    strength >= 50 ? '#f39c12' : '#e74c3c';
                
                return hasLength && hasUppercase && hasLowercase && hasNumber;
            }
            
            // Hash password (demo - kh√¥ng d√πng cho production)
            function hashPassword(password) {
                return btoa(encodeURIComponent(password)); // Base64 encoding
            }
            
            // Save user to LocalStorage
            function saveUser(userData) {
                try {
                    // Get existing users
                    const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    
                    // Check if email already exists
                    const emailExists = users.some(user => user.email === userData.email);
                    if (emailExists) {
                        alert('Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω!');
                        return false;
                    }
                    
                    // Add new user
                    users.push(userData);
                    
                    // Save to LocalStorage
                    localStorage.setItem('registeredUsers', JSON.stringify(users));
                    
                    // Check storage limit (5MB)
                    const storageSize = JSON.stringify(users).length * 2;
                    if (storageSize > 5 * 1024 * 1024) {
                        alert('ƒê√£ ƒë·∫°t gi·ªõi h·∫°n l∆∞u tr·ªØ!');
                        localStorage.removeItem('registeredUsers');
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('L·ªói khi l∆∞u v√†o LocalStorage:', error);
                    return false;
                }
            }
            
            // Load and display users
            function loadUsers() {
                try {
                    const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    usersContainer.innerHTML = '';
                    
                    if (users.length === 0) {
                        usersContainer.innerHTML = '<p>Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o ƒëƒÉng k√Ω.</p>';
                        return;
                    }
                    
                    // Display each user
                    users.forEach((user, index) => {
                        const userElement = document.createElement('div');
                        userElement.className = 'user-item';
                        userElement.innerHTML = `
                            <div>
                                <strong>${user.name}</strong>
                                <div class="user-email">${user.email}</div>
                            </div>
                            <small>#${index + 1}</small>
                        `;
                        usersContainer.appendChild(userElement);
                    });
                } catch (error) {
                    console.error('L·ªói khi ƒë·ªçc t·ª´ LocalStorage:', error);
                }
            }
            
            // Real-time validation
            nameInput.addEventListener('input', function() {
                const isValid = validateName(this.value);
                this.classList.toggle('error', !isValid);
                this.classList.toggle('success', isValid);
                nameError.style.display = isValid ? 'none' : 'block';
            });
            
            emailInput.addEventListener('input', function() {
                const isValid = validateEmail(this.value);
                this.classList.toggle('error', !isValid);
                this.classList.toggle('success', isValid);
                emailError.style.display = isValid ? 'none' : 'block';
            });
            
            passwordInput.addEventListener('input', function() {
                const isValid = validatePassword(this.value);
                this.classList.toggle('error', !isValid);
                this.classList.toggle('success', isValid);
                passwordError.style.display = isValid ? 'none' : 'block';
            });
            
            termsCheckbox.addEventListener('change', function() {
                termsError.style.display = this.checked ? 'none' : 'block';
            });
            
            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate all fields
                const isNameValid = validateName(nameInput.value);
                const isEmailValid = validateEmail(emailInput.value);
                const isPasswordValid = validatePassword(passwordInput.value);
                const isTermsAccepted = termsCheckbox.checked;
                
                // Show errors if any
                nameInput.classList.toggle('error', !isNameValid);
                nameInput.classList.toggle('success', isNameValid);
                nameError.style.display = isNameValid ? 'none' : 'block';
                
                emailInput.classList.toggle('error', !isEmailValid);
                emailInput.classList.toggle('success', isEmailValid);
                emailError.style.display = isEmailValid ? 'none' : 'block';
                
                passwordInput.classList.toggle('error', !isPasswordValid);
                passwordInput.classList.toggle('success', isPasswordValid);
                passwordError.style.display = isPasswordValid ? 'none' : 'block';
                
                termsError.style.display = isTermsAccepted ? 'none' : 'block';
                
                // If all valid
                if (isNameValid && isEmailValid && isPasswordValid && isTermsAccepted) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'ƒêang x·ª≠ l√Ω...';
                    
                    // Create user object
                    const userData = {
                        name: nameInput.value.trim(),
                        email: emailInput.value.trim(),
                        passwordHash: hashPassword(passwordInput.value),
                        registeredAt: new Date().toISOString()
                    };
                    
                    // Save to LocalStorage
                    const saved = saveUser(userData);
                    
                    if (saved) {
                        // Show success message
                        successMessage.style.display = 'block';
                        
                        // Reset form
                        form.reset();
                        
                        // Update password strength indicator
                        passwordStrength.style.width = '0%';
                        
                        // Reload users list
                        loadUsers();
                        
                        // Scroll to success message
                        successMessage.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Re-enable submit button
                    setTimeout(() => {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ƒêƒÉng k√Ω';
                    }, 2000);
                }
            });
            
            // Initial load of users
            loadUsers();
        });
    </script>
</body>
</html>